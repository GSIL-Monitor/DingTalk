window.AlipayH5Keyboad||function(){function t(t){'undefined'!=typeof AlipayJSBridge?t():document.addEventListener("AlipayJSBridgeReady",function(){t()})}function e(){if(document.getElementById('newembedbase'))console.log('newembedbase exists');else{console.log('new newembedbase');var e=document.createElement('param');e.setAttribute('name','type');e.setAttribute('value','newembedbase');var a=document.createElement('object');a.setAttribute('type','application/view');a.setAttribute('id','newembedbase');a.setAttribute('style','z-index:-9999;position:absolute;left:0px;top:0px;width:100%;height:'+document.body.scrollHeight+'px');a.appendChild(e);document.body.appendChild(a)}document.addEventListener("focus",function(e){var a=e.target,i=a.getAttribute("data-keyboard"),u=a.type;n=null;if(a&&("input"==a.tagName.toLowerCase()||"textarea"==a.tagName.toLowerCase())&&i&&""!=i&&"text"==i){n=a;var d=!1;o&&!r(a)?d=!0:o||(d=!0);"password"==u&&(d=!1);if(d&&a._sourceBlur){a._sourceBlur();t(function(){var t=l.getInputParamWithElement(n,!1);if(t){var e=JSON.parse(t);AlipayJSBridge.call("inputBlurEvent",e)}})}}},!0);var i=null,u=250;-1!=navigator.userAgent.search(/iPhone\sOS\s(10|9|8)_(1|2)/gi)&&(u=300);window.addEventListener('resize',function(e){if(n){var r=n.getAttribute("data-keyboard");r&&""!=r&&"text"==r&&t(function(){clearTimeout(i);i=setTimeout(function(){var t=l.getInputParamWithElement(n,!0);if(t){var e=JSON.parse(t);AlipayJSBridge.call("resizeNativeKeyBoardInput",e)}},u)})}});var d=HTMLInputElement.prototype.blur;HTMLInputElement.prototype.blur=function(){var e=this.getAttribute('data-keyboard');e&&""!=e&&t(function(){AlipayJSBridge.call("hideCustomKeyBoard")});return d.apply(this,arguments)};HTMLInputElement.prototype._sourceBlur=d;var s=HTMLTextAreaElement.prototype.blur;HTMLTextAreaElement.prototype.blur=function(){var e=this.getAttribute('data-keyboard');e&&""!=e&&t(function(){AlipayJSBridge.call("hideCustomKeyBoard")});return s.apply(this,arguments)};HTMLTextAreaElement.prototype._sourceBlur=s}var n,r=function(t){if(t&&t.nodeType){for(var e=t;e;){if("fixed"==window.getComputedStyle(e).position)return!0;if(e===document||e===document.documentElement||e===document.body)break;e=e.parentNode}return!1}},a=function(t,e){if(t&&t.nodeType){for(var n=t;n;){if(n.tagName&&n.tagName.toLowerCase()==e)return n;if(n===document||n===document.documentElement||n===document.body)break;n=n.parentNode}return null}},o=-1!=navigator.userAgent.search(/iPhone OS 10_(1|2)/gi);window.SHOULDH5CUSTOMKEYBOARDRUNSPVERSION&&(o=!1);var i=-1!==navigator.userAgent.search("Nebula WK"),u=1,l={_getOffset:function(t){var e=document.getElementsByClassName('h5numInput')[t];return this._getEleOffset(e)},getInputOffset:function(t){return JSON.stringify(this._getOffset(t))},_getEleOffset:function(t){var e=document.querySelector('meta[name=viewport]').getAttribute('content').match(/initial-scale=\s*([0-9.]+)/)[1],n=parseFloat(e),r=window.getComputedStyle(t).paddingLeft;'center'==window.getComputedStyle(t).textAlign&&(r=0);return{x:(parseFloat(r)+t.getBoundingClientRect().left)*n,y:(t.getBoundingClientRect().top+document.body.scrollTop)*n,yt:t.getBoundingClientRect().top*n,w:(t.offsetWidth-parseFloat(r))*n,h:t.offsetHeight*n}},getInputParam:function(t){var e=document.getElementsByClassName('h5numInput')[t];e.setAttribute('readonly','true');e.setAttribute('placeholder','');var n,r=e.getAttribute('h5kb-color'),a=window.getComputedStyle(e).color;if(r&&r.length)n=r;else{n=a;e.setAttribute('h5kb-color',a)}var o=parseFloat(window.getComputedStyle(e).fontSize);e.style.color=window.getComputedStyle(e).backgroundColor;var i=document.querySelector('meta[name=viewport]').getAttribute('content').match(/initial-scale=\s*([0-9.]+)/)[1],u=parseFloat(i);return{offset:this._getOffset(t),placeholder:this.getPlaceholder(t),type:e.getAttribute('type')||'text',kbType:e.getAttribute('kb-type')||e.getAttribute('data-kb-type')||0,value:e.value||'',color:n,fontSize:o*u,fontWeight:window.getComputedStyle(e).fontWeight,maxlength:parseInt(e.getAttribute('maxlength'))||-1,canPaste:!('false'==e.getAttribute('data-paste')),textAlign:window.getComputedStyle(e).textAlign}},dispatchEventWithElement:function(t,e,n,r){if(t){console.log("xxx dispatchEventWithElement "+e);if("blur"==e){var o=new FocusEvent("blur");o.initEvent("blur",!1,!1);o.simulated=!0;t.dispatchEvent(o);if(r&&"r"==r){var i=a(t,"form");i&&i.submit&&i.submit()}window._currentInput=null}else if("keydown"==e){(u=new KeyboardEvent("keydown",{keyCode:n||0})).data={keyCode:n||0};u.initEvent("keydown",!1,!1);t.dispatchEvent(u)}else if("keyup"==e){var u=new KeyboardEvent("keyup",{keyCode:n||0});u.data={keyCode:n||0};u.initEvent("keyup",!1,!1);t.dispatchEvent(u)}else if("input"==e){if(r&&""!=r||46==n){var l=new Event("input",{bubbles:!0,cancelable:!1});l.data=r;l.simulated=!0;t.dispatchEvent(l)}}else if("change"==e){var d=new Event("change",{bubbles:!0,cancelable:!1});t.dispatchEvent(d)}}},getInputParamWithElement:function(t,e){var a;if(!(!(a=n||t)||a&&a.tagName&&"input"!=a.tagName.toLowerCase()&&"textarea"!=a.tagName.toLowerCase()||r(a)&&o&&i)){var l=a.getAttribute('data-keyboard');if(!l){window._currentInput=null;return"input"==a.tagName.toLowerCase()||"textarea"==a.tagName.toLowerCase()?JSON.stringify({isNoNeedKeyBoardInput:"YES"}):void 0}if(a&&"password"==a.type)return JSON.stringify({isNoNeedKeyBoardInput:"YES"});"idcard"!=l&&"digit"!=l||setTimeout(function(){e||a.setAttribute("type","text")},0);window._currentInput=a;var d=a.getAttribute('h5kb-color'),s=a.getAttribute('placeholder');if(s&&""!=s&&!e){a.setAttribute("data-kb-placeholder",s);a.placeholder=""}var c,p=window.getComputedStyle(a).color,g=a.style.color;if(d&&d.length)c=d;else{c=p;setTimeout(function(){if(!e){a.setAttribute('h5kb-color',p);if(g&&""!=g&&null!=g){a.setAttribute('isStyleColor',!0);a.setAttribute('isStyleColorVal',g)}}},0)}var m=parseFloat(window.getComputedStyle(a).fontSize),f=window.getComputedStyle(a).fontFamily;e||(a.style.color=window.getComputedStyle(a).backgroundColor);var b=a.getAttribute("data-kbel-id");if(!b){b=u++;setTimeout(function(){a.setAttribute("data-kbel-id",b)},0)}var y=document.querySelector('meta[name=viewport]').getAttribute('content').match(/initial-scale=\s*([0-9.]+)/)[1],h=parseFloat(y),v=parseFloat(window.getComputedStyle(a).borderWidth),w=(parseFloat(window.getComputedStyle(_currentInput).borderLeftWidth),parseFloat(window.getComputedStyle(_currentInput).borderRightWidth),parseFloat(window.getComputedStyle(_currentInput).borderTopWidth)),A=this._getEleOffset(a);v&&v>0&&(A.yt=A.yt+w||v);var S=s;S||(S=a.getAttribute("data-kb-placeholder")?a.getAttribute("data-kb-placeholder"):"");return JSON.stringify({position:r(a)?"fixed":"static",offset:A,placeholder:S,type:a.getAttribute('type')||'text',keyboard:a.getAttribute('data-keyboard'),value:a.value||'',color:c,fontSize:m*h,fontFamily:f,fontWeight:window.getComputedStyle(a).fontWeight,maxlength:parseInt(a.getAttribute('maxlength'))||-1,canPaste:!('false'==a.getAttribute('data-paste')),textAlign:window.getComputedStyle(a).textAlign,selectionStart:parseFloat(a.getAttribute("data-selection-start")?a.getAttribute("data-selection-start"):"-1"),selectionEnd:parseFloat(a.getAttribute("data-selection-end")?a.getAttribute("data-selection-end"):"-1"),returnType:a.getAttribute("data-return-type")?a.getAttribute("data-return-type"):"",canReturn:a.getAttribute("data-return")?a.getAttribute("data-return"):"Y",cursor:parseFloat(a.getAttribute("data-cursor")?a.getAttribute("data-cursor"):"-1"),kbElId:parseInt(b)})}},restoreInputElement:function(t){console.log("restoreInputElement "+t);var e=document.querySelector("[data-kbel-id='"+t+"']");if(e){1==e.getAttribute('isStyleColor')?e.style.color=e.getAttribute('h5kb-color'):e.style.color=null;var r=e.getAttribute("data-kb-placeholder");if(r&&""!=r){e.removeAttribute("data-kb-placeholder");e.placeholder=r}e.removeAttribute('h5kb-color');e.removeAttribute('isStyleColor')}else console.error("::data-kbel-id::",t);n=null},getPlaceholder:function(t){return document.getElementsByClassName('h5numInput')[t].getAttribute('data-placeholder')||''},setInputValue:function(t,e){document.getElementsByClassName('h5numInput')[t].value=e},setInputValue4Android:function(t){window._currentInput.value=t},fixWKFixElementScrollBug:function(){document.addEventListener("touchmove",function(e){t(function(){r(window._currentInput)&&AlipayJSBridge.call("hideCustomKeyBoard")})},!0)},init:function(){for(var t=[],e=document.getElementsByClassName('h5numInput'),n=0;n<e.length;n++)t.push(this.getInputParam(n));t.length>0&&('undefined'!=typeof AlipayJSBridge?AlipayJSBridge.call('createInput',{param:t}):document.addEventListener("AlipayJSBridgeReady",function(){AlipayJSBridge.call('createInput',{param:t})}));document.addEventListener('getNewOffset',function(t,e){var n=this._getOffset(index);AlipayJSBridge.callback&&AlipayJSBridge.callback({clientId:e,offset:n})});window.SHOULDUESH5KEYBOARD&&-1!==navigator.userAgent.search("Nebula WK")&&l.fixWKFixElementScrollBug()}};l._getInputJsonWithElement=function(t){var e=l.getInputParamWithElement(t,!0);try{e&&(e=JSON.parse(e))}catch(t){console.error('json transform error:',t,e)}return e};document.addEventListener("AlipayJSBridgeReady",function(){});/complete|loaded|interactive/.test(document.readyState)?setTimeout(function(){e()},1):document.addEventListener('DOMContentLoaded',function(){e()},!1);l.version='1.5.1';window.AlipayH5Keyboad=l}();
// do not modify
